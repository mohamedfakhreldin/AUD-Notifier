!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).AUDNotifier=n()}(this,(function(){"use strict";var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};function n(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var e=function(){return e=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},e.apply(this,arguments)};function o(t,n,e,o){return new(e||(e=Promise))((function(i,r){function s(t){try{u(o.next(t))}catch(t){r(t)}}function c(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((o=o.apply(t,n||[])).next())}))}function i(t,n){var e,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(u){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(s=0)),s;)try{if(e=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,o=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(6===c[0]&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=n.call(t,s)}catch(t){c=[6,t],o=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(){function t(t,n,e,o){this.timeout=!0,this.platform=n,this.browser=e,this.version=o,this.options=t}return t.prototype.sendNotificationRepeatedly=function(t,n,e,o){if(this.timeout)return this.sendNotification(t,n),this._repeatNotify(t,e,o)},t.prototype.sendDesktopNotificationRepeatedly=function(t,n,e,o){return"pc"==this.platform?this.sendNotificationRepeatedly(t,n,e,o):this._setPromisePolyfil()},t.prototype.sendMobileNotificationRepeatedly=function(t,n,e,o){return"mobile"==this.platform?this.sendNotificationRepeatedly(t,n,e,o):this._setPromisePolyfil()},t.prototype._mergeOptions=function(t){this.options=t||{}},t.prototype.setServiceWorkerSettings=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(e){switch(e.label){case 0:return this._config?(this._config.file=t.file||this._config.file,this._config.scope=t.scope||this._config.scope,[4,navigator.serviceWorker.ready]):[3,2];case 1:null==(n=e.sent())||n.unregister(),navigator.serviceWorker.register(this._config.file,{scope:this._config.scope}),e.label=2;case 2:return[2]}}))}))},t.prototype.sendMobileNotification=function(t,n){return"mobile"==this.platform?this.sendNotification(t,n):this._setPromisePolyfil()},t.prototype.sendDesktopNotification=function(t,n){return"pc"==this.platform?this.sendNotification(t,n):this._setPromisePolyfil()},t.prototype._repeatNotify=function(t,n,e,o){var i=this;void 0===n&&(n=1),void 0===e&&(e=1e3),void 0===o&&(o=0),o<n&&setTimeout((function(){i._showNotification(t,i.options,!0),i._repeatNotify(t,n,e,++o)}),e instanceof Array?e[o]||e[e.length-1]:e)},t.prototype._checkPermission=function(){return this.Permission.isDefault()&&this.Permission.requestPermission({}),!!this.Permission.isGranted()||(this.timeout=!1,console.error("AUDNotifierError: you must allow notification to send browser notification"),!1)},t.prototype._setPromisePolyfil=function(){return{close:function(){},then:function(t){t(this)}}},t.prototype.sendNotification=function(t,n){if(!t)throw new Error("title must have value ");return this._mergeOptions(n),this._showNotification(t,this.options)},t}();var s=function(){this.GRANTED="granted",this.DENIED="denied",this.DEFAULT="default"},c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(e){switch(e.label){case 0:return[4,Notification.requestPermission()];case 1:return n=e.sent(),t instanceof Object?n==this.GRANTED&&"function"==typeof t.onGranted?[2,t.onGranted()]:n==this.DENIED&&"function"==typeof t.onDenied?[2,t.onDenied()]:n==this.DEFAULT&&"function"==typeof t.onDefault?[2,t.onDefault()]:[2,n]:[2]}}))}))},e.prototype.isGranted=function(){return this.get()==this.GRANTED},e.prototype.isDenied=function(){return this.get()==this.DENIED},e.prototype.isDefault=function(){return this.get()==this.DEFAULT},e.prototype.get=function(){return Notification.permission},e}(s),u=function(){function t(){}return t.setTone=function(n){return o(this,void 0,void 0,(function(){var e,o,r,s,c,u,a,f,l;return i(this,(function(i){switch(i.label){case 0:if(!n||void 0===AudioContext||!Promise)return[3,6];if(n instanceof Object&&n.src)e=n.volume,n=n.src;else if("string"!=typeof n)return[2,!1];t.running&&t.tone&&"string"!=typeof t.tone&&t.tone.stop(),t.running=!1,o=new AudioContext,i.label=1;case 1:return i.trys.push([1,5,,6]),r=t.tonesCaches,s=n,(c=t.tonesCaches[n])?[3,4]:(a=(u=o).decodeAudioData,[4,t.loadSound(n)]);case 2:return[4,a.apply(u,[i.sent()])];case 3:c=i.sent(),i.label=4;case 4:return r[s]=c,(l=o.createGain()).gain.value=e||.5,l.connect(o.destination),(f=o.createBufferSource()).buffer=t.tonesCaches[n],f.connect(l),t.tone=f,[2,!0];case 5:return i.sent(),console.error("can't load audio file"),[2,!1];case 6:return[2,!1]}}))}))},t.loadSound=function(n){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.tone="loading","function"!=typeof fetch?[3,2]:[4,fetch(n)];case 1:return[2,e.sent().arrayBuffer()];case 2:return[2,new Promise((function(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onload=function(){t(e.response)},e.open("GET",n,!0),e.send()}))]}}))}))},t.running=!1,t.tonesCaches={},t}(),a=function(t){function r(n,e,o,i){var r=t.call(this,n,e,o,i)||this;return r._id=1,r.notifications={},r.Permission=r.Permission||new c,r}return n(r,t),r.prototype._checkPermission=function(){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.Permission.isDefault()?[4,this.Permission.requestPermission({})]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Permission.isGranted()?[2,!0]:(this.timeout=!1,console.error("AUDNotifierError: you must allow notification to send browser notification"),[2,!1])}}))}))},r.prototype._showNotification=function(t,n){return o(this,void 0,void 0,(function(){var r=this;return i(this,(function(s){return[2,new Promise((function(s,c){return o(r,void 0,void 0,(function(){var r,a,f,l,p,h,d,y,w,v,m,g=this;return i(this,(function(b){switch(b.label){case 0:return b.trys.push([0,4,,5]),[4,this._checkPermission()];case 1:return b.sent()?(r=n.audio,a=n.onClick,f=n.onClose,l=n.onShow,p=n.onError,h=n.redirect,d=n.closeAfter,delete(y=e({},n)).audio,y.onClick,y.onClose,y.onError,y.onShow,w=y,[4,u.setTone(r)]):[3,3];case 2:w.slient=b.sent(),v=new Notification(t,n),r&&!u.running&&v&&u.tone&&"string"!=typeof u.tone&&(u.tone.start(0),u.running=!0),this.notifications[(null==n?void 0:n.tag)||"customtag"+this._id++]=v,v.onshow=function(t){return o(g,void 0,void 0,(function(){return i(this,(function(n){return"function"==typeof l&&l(t),[2]}))}))},"number"==typeof d&&setTimeout((function(){return v.close()}),d),v.onclick=function(t){var n;"function"==typeof a&&a(t),"string"==typeof(n=h)?window.location.href=n:"object"==typeof n&&n.link&&(n.focus&&window.open(n.link,n.target||"_blank").focus(),window.open(n.link,n.target||"_blank"))},v.onerror=p,v.onclose=function(t){delete g.notifications[(null==n?void 0:n.tag)||"customtag"+g._id],"function"==typeof a&&f(t)},s(v),b.label=3;case 3:return c("AUDNotifierError: you must allow notification to send browser notification"),[3,5];case 4:return m=b.sent(),c(m),[3,5];case 5:return[2]}}))}))}))]}))}))},r.prototype.close=function(t){this.notifications[t]&&(this.notifications[t].close(),delete this.notifications[t])},r.prototype.clear=function(){for(var t in this.notifications)this.notifications[t].close(),delete this.notifications[t]},r}(r),f=function(t){function e(n,e,o,i){var r=t.call(this,n,e,o,i)||this;return r._config={file:"service-worker.js",scope:"./"},r.Permission=r.Permission||new c,navigator.serviceWorker.register(r._config.file),r}return n(e,t),e.prototype._handleEvents=function(t){if("function"==typeof t){var n=t.toString();return n="return ("+n+")(e)"}},e.prototype._checkPermission=function(){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.Permission.isDefault()?[4,this.Permission.requestPermission({})]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Permission.isGranted()?[2,!0]:(this.timeout=!1,console.error("AUDNotifierError: you must allow notification to send browser notification"),[2,!1])}}))}))},e.prototype._showNotification=function(t,n){return o(this,void 0,void 0,(function(){var e=this;return i(this,(function(r){return[2,new Promise((function(r,s){return o(e,void 0,void 0,(function(){var e,c,a,f,l,p,h,d,y,w=this;return i(this,(function(v){switch(v.label){case 0:e=this.options,c=e.onClick,a=e.onClose,f=e.onError,l=e.closeAfter,p=e.audio,h=e.redirect,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,this._checkPermission()];case 2:if(v.sent()){if(navigator.serviceWorker.ready)return[2,navigator.serviceWorker.getRegistration().then((function(e){return o(w,void 0,void 0,(function(){var r,s,y=this;return i(this,(function(w){switch(w.label){case 0:return[4,e.getNotifications()];case 1:return r=w.sent(),n.data=n.data instanceof Object?n.data:{},n.data.redirect=h,s=n,[4,u.setTone(p)];case 2:return s.slient=w.sent(),n.data.onClick=this._handleEvents(c),n.data.onClose=this._handleEvents(a),!u.running&&u.tone&&"string"!=typeof u.tone&&(u.tone.start(0),u.running=!0),e.showNotification(t,n).then((function(){return o(y,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.getNotifications()];case 1:return r=t.sent(),d=r[r.length-1],"number"==typeof l&&setTimeout((function(){return d.close()}),l),[2]}}))}))})).catch((function(t){"function"==typeof f&&f(t)})),[2]}}))}))}))];r(d)}return s("AUDNotifierError: you must allow notification to send browser notificatio"),[3,4];case 3:return y=v.sent(),s(y),[3,4];case 4:return[2]}}))}))}))]}))}))},e.prototype.close=function(t){navigator.serviceWorker.getRegistration().then((function(n){n.getNotifications({tag:t}).then((function(t){t[0].close()}))}))},e.prototype.clear=function(){navigator.serviceWorker.getRegistration().then((function(t){t.getNotifications().then((function(t){for(var n=0;n<t.length;n++)t[n].close()}))}))},e}(r),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){"function"==typeof t.onGranted&&t.onGranted()},e.prototype.isGranted=function(){return!0},e.prototype.isDenied=function(){return!1},e.prototype.isDefault=function(){return!1},e.prototype.get=function(){return this.GRANTED},e}(s),p=function(t){function o(n,e,o,i){var r=t.call(this,n,e,o,i)||this;return r.Permission=r.Permission||new l,r}return n(o,t),o.prototype._showNotification=function(t,n){var o,i=null===(o=navigator.mozNotification)||void 0===o?void 0:o.createNotification(n.icon,t,n.body);return i.show(),i.close=function(){},e(e({},i),{then:function(t){t(i)}})},o.prototype.close=function(){console.warn("Close not supported in your browser")},o.prototype.clear=function(){console.warn("Clear not supported in your browser")},o}(r),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){var n,e=this;null===(n=window.webkitNotifications)||void 0===n||n.requestPermission((function(n){if(n==e.GRANTED&&"function"==typeof t.onGranted)t.onGranted();else if(n==e.DENIED&&"function"==typeof t.onDenied)t.onDenied();else if(n==e.DEFAULT&&"function"==typeof t.onDefault)return t.onDefault();if(e.isDenied()||e.isDefault())throw new Error("you must allow notification to send browser notification")}))},e.prototype.isGranted=function(){return window.webkitNotifications.checkPermission()==this.GRANTED},e.prototype.isDenied=function(){return window.webkitNotifications.checkPermission()==this.DENIED},e.prototype.isDefault=function(){return window.webkitNotifications.checkPermission()==this.DEFAULT},e.prototype.get=function(){return window.webkitNotifications.checkPermission()},e}(s),d=function(t){function o(n,e,o,i){var r=t.call(this,n,e,o,i)||this;return r.id=1,r.Permission=r.Permission||new h,r}return n(o,t),o.prototype._showNotification=function(t,n){var o;if(this._checkPermission()){var i=null===(o=window.webkitNotifications)||void 0===o?void 0:o.createNotification(n.icon,t,n.body);return i.show(),i.close=i.cancel,n.closeAfter&&setTimeout(i.close,n.closeAfter),this.notifications[n.tag||this.id++]=i,e(e({},i),{then:function(t){t(i)}})}return{close:function(){}}},o.prototype.close=function(t){this.notifications[t]&&(this.notifications[t].close(),delete this.notifications[t])},o.prototype.clear=function(){for(var t in this.notifications)this.notifications[t].close(),delete this.notifications[t]},o}(r),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){window.external.msSiteMode()&&"function"==typeof t.onGranted?t.onGranted():window.external.msSiteMode()&&"function"==typeof t.onDefault&&t.onDefault()},e.prototype.isGranted=function(){return window.external.msSiteMode()},e.prototype.isDenied=function(){return!1},e.prototype.isDefault=function(){return!window.external.msSiteMode()},e.prototype.get=function(){return window.external.msSiteMode()?this.GRANTED:this.DEFAULT},e}(s),w=function(t){function e(n,e,o,i){var r=t.call(this,n,e,o,i)||this;return r.Permission=r.Permission||new y,r}return n(e,t),e.prototype._showNotification=function(t,n){if(this._checkPermission()){window.external.msSiteModeClearIconOverlay(),window.external.msSiteModeSetIconOverlay(n.icon,t),window.external.msSiteModeActivate();var e={close:window.external.msSiteModeClearIconOverlay,then:function(t){t(this)}};return n.closeAfter&&setTimeout((function(){return e.close()}),n.closeAfter),e}return{close:function(){}}},e.prototype.close=function(){window.external.msSiteModeClearIconOverlay()},e.prototype.clear=function(){window.external.msSiteModeClearIconOverlay()},e}(r);return new function(){var t=/edg/i.test(navigator.userAgent)?{browser:"edge",version:navigator.userAgent.split(/edg\//i)[1].split(" ")[0].split(".")[0]}:/firefox/i.test(navigator.userAgent)?{browser:"firefox",version:navigator.userAgent.split(/firefox\//i)[1].split(" ")[0].split(".")[0]}:/chrome/i.test(navigator.userAgent)?{browser:"chrome",version:navigator.userAgent.split(/chrome\//i)[1].split(" ")[0].split(".")[0]}:/^((?!chrome|android).)*(?=.*\bsafari\b)(?=.*\bversion\b).*$/i.test(navigator.userAgent)?{browser:"safari",version:navigator.userAgent.split(/version\//i)[1].split(" ")[0].split(".")[0]}:{browser:null},n=t.browser,e=t.version,o=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((function(t){return navigator.userAgent.match(t)}))?"mobile":"pc";return window.Notification?"chrome"==n&&"mobile"==o&&null!=window.navigator.serviceWorker?new f({},o,n,+e):new a({},o,n,+e):null!=window.navigator.mozNotification?new p({},o,n,+e):null!=window.webKitNotification?new d({},o,n,+e):void 0!==window.external&&void 0!==window.external.msIsSiteMode?new w({},o,n,+e):void console.error("AUDNotifierError: you browser not support AUDNotifier ")}}));
