!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).AUDNotifier=n()}(this,(function(){"use strict";var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};function n(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var e=function(){return e=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t},e.apply(this,arguments)};function i(t,n,e,i){return new(e||(e=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function c(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,c)}u((i=i.apply(t,n||[])).next())}))}function o(t,n){var e,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(u){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(s=0)),s;)try{if(e=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,i=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){s.label=c[1];break}if(6===c[0]&&s.label<o[1]){s.label=o[1],o=c;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(c);break}o[2]&&s.ops.pop(),s.trys.pop();continue}c=n.call(t,s)}catch(t){c=[6,t],i=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}"function"==typeof SuppressedError&&SuppressedError;var r=function(t){function e(n){var e=t.call(this,n)||this;return e.message=n,e.name="AUDNotifierError",e}return n(e,t),e}(Error),s=function(){function t(t,n,e,i){this.timeout=!0,this.platform=n,this.browser=e,this.version=i,this.options=t}return t.prototype.sendNotificationRepeatedly=function(t,n,e,i){if(this.timeout)return this.sendNotification(t,n),this._repeatNotify(t,e,i)},t.prototype.sendDesktopNotificationRepeatedly=function(t,n,e,i){return"pc"==this.platform?this.sendNotificationRepeatedly(t,n,e,i):this._setPromisePolyfil()},t.prototype.sendMobileNotificationRepeatedly=function(t,n,e,i){return"mobile"==this.platform?this.sendNotificationRepeatedly(t,n,e,i):this._setPromisePolyfil()},t.prototype._mergeOptions=function(t){this.options=t||{}},t.prototype.setServiceWorkerSettings=function(t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(e){switch(e.label){case 0:return this._config?(this._config.file=t.file||this._config.file,this._config.scope=t.scope||this._config.scope,[4,navigator.serviceWorker.ready]):[3,2];case 1:null==(n=e.sent())||n.unregister(),navigator.serviceWorker.register(this._config.file,{scope:this._config.scope}),e.label=2;case 2:return[2]}}))}))},t.prototype.sendMobileNotification=function(t,n){return"mobile"==this.platform?this.sendNotification(t,n):this._setPromisePolyfil()},t.prototype.sendDesktopNotification=function(t,n){return"pc"==this.platform?this.sendNotification(t,n):this._setPromisePolyfil()},t.prototype._repeatNotify=function(t,n,e,i){var o=this;void 0===n&&(n=1),void 0===e&&(e=1e3),void 0===i&&(i=0),i<n&&setTimeout((function(){o._showNotification(t,o.options,!0),o._repeatNotify(t,n,e,++i)}),e instanceof Array?e[i]||e[e.length-1]:e)},t.prototype._checkPermission=function(){if(this.Permission.isDefault()&&this.Permission.requestPermission({}),!this.Permission.isGranted())throw this.timeout=!1,new r("you must allow notification to send browser notification")},t.prototype._setPromisePolyfil=function(){return{close:function(){},then:function(t){t(this)}}},t.prototype.sendNotification=function(t,n){if(!t)throw new Error("title must have value ");return this._mergeOptions(n),this._showNotification(t,this.options)},t}();var c=function(){this.GRANTED="granted",this.DENIED="denied",this.DEFAULT="default"},u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(e){switch(e.label){case 0:return[4,Notification.requestPermission()];case 1:return n=e.sent(),t instanceof Object?n==this.GRANTED&&"function"==typeof t.onGranted?[2,t.onGranted()]:n==this.DENIED&&"function"==typeof t.onDenied?[2,t.onDenied()]:n==this.DEFAULT&&"function"==typeof t.onDefault?[2,t.onDefault()]:[2,n]:[2]}}))}))},e.prototype.isGranted=function(){return this.get()==this.GRANTED},e.prototype.isDenied=function(){return this.get()==this.DENIED},e.prototype.isDefault=function(){return this.get()==this.DEFAULT},e.prototype.get=function(){return Notification.permission},e}(c),a=function(){function t(){}return t.setTone=function(n){return i(this,void 0,void 0,(function(){var e,i,r,s,c,u,a,f,l;return o(this,(function(o){switch(o.label){case 0:if(!n||void 0===AudioContext||!Promise)return[3,6];if(n instanceof Object&&n.src)e=n.volume,n=n.src;else if("string"!=typeof n)return[2,!1];t.running&&t.tone&&"string"!=typeof t.tone&&t.tone.stop(),t.running=!1,i=new AudioContext,o.label=1;case 1:return o.trys.push([1,5,,6]),r=t.tonesCaches,s=n,(c=t.tonesCaches[n])?[3,4]:(a=(u=i).decodeAudioData,[4,t.loadSound(n)]);case 2:return[4,a.apply(u,[o.sent()])];case 3:c=o.sent(),o.label=4;case 4:return r[s]=c,(l=i.createGain()).gain.value=e||.5,l.connect(i.destination),(f=i.createBufferSource()).buffer=t.tonesCaches[n],f.connect(l),t.tone=f,[2,!0];case 5:return o.sent(),console.error("can't load audio file"),[2,!1];case 6:return[2,!1]}}))}))},t.loadSound=function(n){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return t.tone="loading","function"!=typeof fetch?[3,2]:[4,fetch(n)];case 1:return[2,e.sent().arrayBuffer()];case 2:return[2,new Promise((function(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onload=function(){t(e.response)},e.open("GET",n,!0),e.send()}))]}}))}))},t.running=!1,t.tonesCaches={},t}(),f=function(t){function s(n,e,i,o){var r=t.call(this,n,e,i,o)||this;return r._id=1,r.notifications={},r.Permission=r.Permission||new u,r}return n(s,t),s.prototype._checkPermission=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.Permission.isDefault()?[4,this.Permission.requestPermission({})]:[3,2];case 1:t.sent(),t.label=2;case 2:if(!this.Permission.isGranted())throw this.timeout=!1,new r("you must allow notification to send browser notification");return[2]}}))}))},s.prototype._showNotification=function(t,n){return i(this,void 0,void 0,(function(){var r,s,c,u,f,l,p,h,d,w,y=this;return o(this,(function(v){switch(v.label){case 0:return[4,this._checkPermission()];case 1:return v.sent(),r=n.audio,s=n.onClick,c=n.onClose,u=n.onShow,f=n.onError,l=n.redirect,p=n.closeAfter,delete(h=e({},n)).audio,h.onClick,h.onClose,h.onError,h.onShow,d=h,[4,a.setTone(r)];case 2:return d.slient=v.sent(),w=new Notification(t,n),r&&!a.running&&w&&a.tone&&"string"!=typeof a.tone&&(a.tone.start(0),a.running=!0),this.notifications[(null==n?void 0:n.tag)||"customtag"+this._id++]=w,w.onshow=function(t){return i(y,void 0,void 0,(function(){return o(this,(function(n){return"function"==typeof u&&u(t),[2]}))}))},"number"==typeof p&&setTimeout((function(){return w.close()}),p),w.onclick=function(t){var n;"function"==typeof s&&s(t),"string"==typeof(n=l)?window.location.href=n:"object"==typeof n&&n.link&&(n.focus&&window.open(n.link,n.target||"_blank").focus(),window.open(n.link,n.target||"_blank"))},w.onerror=f,w.onclose=function(t){delete y.notifications[(null==n?void 0:n.tag)||"customtag"+y._id],"function"==typeof s&&c(t)},[2,w]}}))}))},s.prototype.close=function(t){this.notifications[t]&&(this.notifications[t].close(),delete this.notifications[t])},s.prototype.clear=function(){for(var t in this.notifications)this.notifications[t].close(),delete this.notifications[t]},s}(s),l=function(t){function e(n,e,i,o){var r=t.call(this,n,e,i,o)||this;return r._config={file:"service-worker.js",scope:"/"},r.Permission=r.Permission||new u,navigator.serviceWorker.register(r._config.file),r}return n(e,t),e.prototype._handleEvents=function(t){if("function"==typeof t){var n=t.toString();return n="return ("+n+")(e)"}},e.prototype._checkPermission=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.Permission.isDefault()?[4,this.Permission.requestPermission({})]:[3,2];case 1:t.sent(),t.label=2;case 2:if(!this.Permission.isGranted())throw this.timeout=!1,new r("you must allow notification to send browser notification");return[2]}}))}))},e.prototype._showNotification=function(t,n){var e=this,r=this.options,s=r.onClick,c=r.onClose,u=r.onError,f=r.closeAfter,l=r.audio,p=r.redirect;if(this._checkPermission(),navigator.serviceWorker.ready)return navigator.serviceWorker.getRegistration().then((function(r){return i(e,void 0,void 0,(function(){var e,h,d,w=this;return o(this,(function(y){switch(y.label){case 0:return[4,r.getNotifications()];case 1:return(e=y.sent()).some((function(t){})),n.data=!(n.data instanceof Object)||{},n.data.redirect=p,d=n,[4,a.setTone(l)];case 2:return d.slient=y.sent(),n.data.onClick=this._handleEvents(s),n.data.onClose=this._handleEvents(c),!a.running&&a.tone&&"string"!=typeof a.tone&&(a.tone.start(0),a.running=!0),r.showNotification(t,n).then((function(){return i(w,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,r.getNotifications()];case 1:return e=t.sent(),h=e[e.length-1],"number"==typeof f&&setTimeout((function(){return h.close()}),f),[2]}}))}))})).catch((function(t){u(t)})),[2]}}))}))}))},e.prototype.close=function(t){navigator.serviceWorker.getRegistration().then((function(n){n.getNotifications({tag:t}).then((function(t){t[0].close()}))}))},e.prototype.clear=function(){navigator.serviceWorker.getRegistration().then((function(t){t.getNotifications().then((function(t){for(var n=0;n<t.length;n++)t[n].close()}))}))},e}(s),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){"function"==typeof t.onGranted&&t.onGranted()},e.prototype.isGranted=function(){return!0},e.prototype.isDenied=function(){return!1},e.prototype.isDefault=function(){return!1},e.prototype.get=function(){return this.GRANTED},e}(c),h=function(t){function i(n,e,i,o){var r=t.call(this,n,e,i,o)||this;return r.Permission=r.Permission||new p,r}return n(i,t),i.prototype._showNotification=function(t,n){var i;this._checkPermission();var o=null===(i=navigator.mozNotification)||void 0===i?void 0:i.createNotification(n.icon,t,n.body);return o.show(),o.close=function(){},e(e({},o),{then:function(t){t(o)}})},i.prototype.close=function(){console.warn("Close not supported in your browser")},i.prototype.clear=function(){console.warn("Clear not supported in your browser")},i}(s),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){var n,e=this;null===(n=window.webkitNotifications)||void 0===n||n.requestPermission((function(n){if(n==e.GRANTED&&"function"==typeof t.onGranted)t.onGranted();else if(n==e.DENIED&&"function"==typeof t.onDenied)t.onDenied();else if(n==e.DEFAULT&&"function"==typeof t.onDefault)return t.onDefault();if(e.isDenied()||e.isDefault())throw new Error("you must allow notification to send browser notification")}))},e.prototype.isGranted=function(){return window.webkitNotifications.checkPermission()==this.GRANTED},e.prototype.isDenied=function(){return window.webkitNotifications.checkPermission()==this.DENIED},e.prototype.isDefault=function(){return window.webkitNotifications.checkPermission()==this.DEFAULT},e.prototype.get=function(){return window.webkitNotifications.checkPermission()},e}(c),w=function(t){function i(n,e,i,o){var r=t.call(this,n,e,i,o)||this;return r.id=1,r.Permission=r.Permission||new d,r}return n(i,t),i.prototype._showNotification=function(t,n){var i;this._checkPermission();var o=null===(i=window.webkitNotifications)||void 0===i?void 0:i.createNotification(n.icon,t,n.body);return o.show(),o.close=o.cancel,n.closeAfter&&setTimeout(o.close,n.closeAfter),this.notifications[n.tag||this.id++]=o,e(e({},o),{then:function(t){t(o)}})},i.prototype.close=function(t){this.notifications[t]&&(this.notifications[t].close(),delete this.notifications[t])},i.prototype.clear=function(){for(var t in this.notifications)this.notifications[t].close(),delete this.notifications[t]},i}(s),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.requestPermission=function(t){window.external.msSiteMode()&&"function"==typeof t.onGranted?t.onGranted():window.external.msSiteMode()&&"function"==typeof t.onDefault&&t.onDefault()},e.prototype.isGranted=function(){return window.external.msSiteMode()},e.prototype.isDenied=function(){return!1},e.prototype.isDefault=function(){return!window.external.msSiteMode()},e.prototype.get=function(){return window.external.msSiteMode()?this.GRANTED:this.DEFAULT},e}(c),v=function(t){function e(n,e,i,o){var r=t.call(this,n,e,i,o)||this;return r.Permission=r.Permission||new y,r}return n(e,t),e.prototype._showNotification=function(t,n){this._checkPermission(),window.external.msSiteModeClearIconOverlay(),window.external.msSiteModeSetIconOverlay(n.icon,t),window.external.msSiteModeActivate();var e={close:window.external.msSiteModeClearIconOverlay,then:function(t){t(this)}};return n.closeAfter&&setTimeout((function(){return e.close()}),n.closeAfter),e},e.prototype.close=function(){window.external.msSiteModeClearIconOverlay()},e.prototype.clear=function(){window.external.msSiteModeClearIconOverlay()},e}(s);return new function(){var t=/edg/i.test(navigator.userAgent)?{browser:"edge",version:navigator.userAgent.split(/edg\//i)[1].split(" ")[0].split(".")[0]}:/firefox/i.test(navigator.userAgent)?{browser:"firefox",version:navigator.userAgent.split(/firefox\//i)[1].split(" ")[0].split(".")[0]}:/chrome/i.test(navigator.userAgent)?{browser:"chrome",version:navigator.userAgent.split(/chrome\//i)[1].split(" ")[0].split(".")[0]}:/^((?!chrome|android).)*(?=.*\bsafari\b)(?=.*\bversion\b).*$/i.test(navigator.userAgent)?{browser:"safari",version:navigator.userAgent.split(/version\//i)[1].split(" ")[0].split(".")[0]}:{browser:null},n=t.browser,e=t.version,i=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((function(t){return navigator.userAgent.match(t)}))?"mobile":"pc";if(window.Notification)return"chrome"==n&&"mobile"==i&&null!=window.navigator.serviceWorker?new l({},i,n,+e):new f({},i,n,+e);if(null!=window.navigator.mozNotification)return new h({},i,n,+e);if(null!=window.webKitNotification)return new w({},i,n,+e);if(void 0!==window.external&&void 0!==window.external.msIsSiteMode)return new v({},i,n,+e);throw new r("you browser not support AUDNotifier ")}}));
//# sourceMappingURL=aud-notifier.js.map
